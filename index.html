<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>心理測驗：你的靈魂像哪種動物？</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* --- 基礎樣式設定 --- */
        :root {
            --bg-color: #f0f0f0; /* 淺灰底背景 */
            --card-bg: #ffffff;
            --primary-color: #555555;
            --accent-color: #333333;
            --font-main: "BiaoKai", "KaiTi", "標楷體", serif; /* 指定標楷體 */
        }

        body {
            background-color: var(--bg-color);
            font-family: var(--font-main);
            color: black;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            box-sizing: border-box;
        }

        /* --- 容器與卡片 --- */
        .container {
            width: 100%;
            max-width: 600px; /* 電腦版最大寬度 */
            margin: 0 auto;
        }

        .card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        h1, h2, h3 {
            text-align: center;
            margin-top: 0;
        }

        /* --- 封面樣式 --- */
        #cover-section {
            display: block; /* 初始顯示 */
            text-align: center;
            padding: 40px 30px;
        }

        .cover-title {
            font-size: 2.2rem;
            margin-bottom: 30px;
            color: var(--accent-color);
            font-weight: bold;
        }

        .cover-intro {
            font-size: 1.2rem;
            line-height: 1.8;
            margin-bottom: 40px;
            color: #555;
        }

        .start-btn {
            background-color: black; /* 開始按鈕用深色 */
            font-size: 1.3rem;
            padding: 18px;
            max-width: 80%;
            margin: 0 auto;
        }
        .start-btn:hover {
            background-color: #333;
        }

        /* --- 進度條 --- */
        .progress-container {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 10px;
            margin-bottom: 20px;
            height: 10px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background-color: var(--primary-color);
            width: 0%;
            transition: width 0.4s ease;
        }

        /* --- 題目區塊 --- */
        #quiz-section {
            display: none; /* 初始隱藏 */
        }

        .question-text {
            font-size: 1.5rem; /* 字體隨螢幕調整 */
            margin-bottom: 25px;
            line-height: 1.6;
            font-weight: bold;
        }

        .options-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .option-label {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.2s, border-color 0.2s;
            font-size: 1.2rem;
        }

        .option-label:hover {
            background-color: #f9f9f9;
            border-color: #aaa;
        }

        /* 隱藏原生 Radio Button，改用自定義圓圈 */
        input[type="radio"] {
            appearance: none;
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid #555;
            border-radius: 50%;
            margin-right: 15px;
            position: relative;
            flex-shrink: 0;
        }

        input[type="radio"]:checked {
            border-color: black;
            background-color: black;
            box-shadow: inset 0 0 0 4px white;
        }

        input[type="radio"]:checked + span {
            font-weight: bold;
        }

        /* 選中時的外框樣式 */
        .option-label.selected {
            border-color: black;
            background-color: #e8e8e8;
        }

        /* --- 按鈕樣式 --- */
        .btn {
            display: block;
            width: 100%;
            padding: 15px;
            margin-top: 25px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.2rem;
            font-family: var(--font-main);
            cursor: pointer;
            transition: background 0.3s;
        }

        .btn:hover {
            background-color: black;
        }

        .btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        /* --- 結果區塊 --- */
        #result-section {
            display: none; /* 初始隱藏 */
            text-align: center;
        }

        .chart-container {
            position: relative;
            height: 300px; /* 控制雷達圖高度 */
            width: 100%;
            margin-bottom: 20px;
            background: white;
            padding: 10px;
            border-radius: 10px;
        }

        .analysis-text {
            text-align: left;
            margin-top: 20px;
            font-size: 1.1rem;
            line-height: 1.8;
            padding: 20px;
            background-color: #f8f8f8;
            border-radius: 10px;
            white-space: pre-wrap; /* 保留換行 */
        }

        .result-title {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .section-header {
            font-weight: bold;
            margin-top: 15px;
            margin-bottom: 5px;
            color: #555;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
            display: inline-block;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        /* --- 響應式調整 (手機版) --- */
        @media (max-width: 480px) {
            .cover-title {
                 font-size: 1.8rem;
            }
            .question-text {
                font-size: 1.2rem;
            }
            .option-label {
                font-size: 1rem;
                padding: 12px;
            }
            .chart-container {
                height: 250px;
            }
            .action-buttons {
                flex-direction: column;
            }
            .start-btn {
                width: 100%;
                max-width: 100%;
            }
        }
    </style>
</head>
<body>

<div class="container">
    
    <div id="cover-section" class="card">
        <h1 class="cover-title">測驗：你的靈魂像哪種動物？</h1>
        <div class="cover-intro">
            <p>每個人內心深處，都住著一種動物靈魂。</p>
            <p>也許是穩重擔當的【馬】，<br>也許是聰慧防備的【狐狸】，<br>
               也許是敏感真誠的【男孩】，<br>又或者是溫暖支持的【鼴鼠】。</p>
            <p style="margin-top: 20px; font-weight: bold;">透過五個問題，探索你在面對挑戰、人際與挫折時的真實樣貌。</p>
        </div>
        <button class="btn start-btn" onclick="startQuiz()">開始測驗</button>
    </div>

    <div id="quiz-section" class="card">
        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>

        <div id="question-container">
            <h2 id="question-number">Question 1/5</h2>
            <p class="question-text" id="question-text">題目載入中...</p>
            
            <div class="options-group" id="options-container">
                </div>
        </div>

        <button class="btn" id="next-btn" onclick="nextQuestion()" disabled>下一題</button>
    </div>

    <div id="result-section" class="card">
        <h2>測驗結果分析</h2>
        
        <div class="chart-container">
            <canvas id="radarChart"></canvas>
        </div>

        <div id="result-content">
            <div class="result-title" id="main-result-type"></div>
            <div class="analysis-text" id="full-analysis"></div>
        </div>

        <div class="action-buttons">
            <button class="btn" onclick="downloadChart()">下載結果圖</button>
            <button class="btn" onclick="restartQuiz()" style="background-color: #888;">重新測驗</button>
        </div>
    </div>

</div>

<script>
    /* =========================================
       1. 資料設定區 
       =========================================
    */
    
    // A=馬, B=狐狸, C=男孩, D=鼴鼠
    const questions = [
        {
            text: "1. 當你遇到一個新的挑戰/任務時，你的第一反應是：",
            options: [
                { text: "馬上跳進去、先試看看", type: "A" },
                { text: "先觀察環境、研究方式", type: "B" },
                { text: "有點猶豫、怕搞砸、先做部分準備", type: "C" },
                { text: "想幫助他人、在背後支撐或配合", type: "D" }
            ]
        },
        {
            text: "2. 在人際互動中，當朋友需要幫忙/情緒低落時，你通常會：",
            options: [
                { text: "鼓勵他們「快起來、一起去做點什麼」", type: "A" },
                { text: "安靜陪伴、傾聽他們說出來", type: "B" },
                { text: "有點退縮、不太確定怎麼幫比較好", type: "C" },
                { text: "主動提供支持、做好後勤或照顧他們", type: "D" }
            ]
        },
        {
            text: "3. 當你在思考人生或尋找方向時，你偏好哪種方式：",
            options: [
                { text: "設定目標、立刻動手實踐", type: "A" },
                { text: "深入思考、寫筆記、分析可能性", type: "B" },
                { text: "小心翼翼、怕錯、慢慢走", type: "C" },
                { text: "和他人分享、互相支持、一步一腳印", type: "D" }
            ]
        },
        {
            text: "4. 面對失敗或挫折，你最可能的反應是：",
            options: [
                { text: "立刻反彈、再戰一次", type: "A" },
                { text: "自我反省、思考教訓", type: "B" },
                { text: "感到沮喪、有點退縮、怕再犯錯", type: "C" },
                { text: "尋求或提供人際支持、共同面對", type: "D" }
            ]
        },
        {
            text: "5. 如果要選擇你最看重的特質，是哪一項：",
            options: [
                { text: "冒險精神 / 行動力", type: "A" },
                { text: "思考深度 / 內在探索", type: "B" },
                { text: "謹慎 / 安全感", type: "C" },
                { text: "溫暖 / 支持他人", type: "D" }
            ]
        }
    ];

    // 結果解析資料
    const resultsData = {
        A: {
            title: "你是【馬型】",
            subtitle: "你習慣當那個「載大家走過去」的人。",
            desc: `
<span class="section-header">你的樣子</span>
你很習慣扛責任、撐住場面。很多時候，你自己其實也會累、也會徬徨，可是你會先問：「大家還好嗎？」你是那種會陪著別人走一段的人，願意當那匹穩穩向前的馬。

<span class="section-header">你給人的感覺</span>
你讓人有安全感。只要你在，事情好像就能慢慢被處理好。很多人會在不知不覺中依賴你、把難題丟給你，因為你看起來總是知道該怎麼做。

<span class="section-header">給你的提醒</span>
你不是永遠都要那麼堅強。當你覺得很重的時候，也可以停下來，把一些重量放回去，或者請別人幫忙扛一點。有時候，真正的力量不是一直往前衝，而是敢在需要的時候說：「我也想被照顧。」`
        },
        B: {
            title: "你是【狐狸型】",
            subtitle: "你看得很清楚，只是習慣把心收好。",
            desc: `
<span class="section-header">你的樣子</span>
你敏銳、細心，對人的真心假意、情況的危險程度，有一種直覺式的判斷。你不會輕易把自己交出去，因為你知道受傷有多痛，所以寧可慢一點、再確定一點。

<span class="section-header">你給人的感覺</span>
一開始，你可能讓人覺得有距離、有點冷，但真正走進你心裡的人都知道：你其實非常忠誠、非常有義氣。你不會亂承諾，一旦說出口，就會盡力做到。

<span class="section-header">給你的提醒</span>
保持界線是好事，但也別把自己關得太緊。不是每個人都會像過去那些人一樣傷害你。你可以試著多給世界一點點機會——不是為了別人，而是為了讓自己有機會好好被對待。`
        },
        C: {
            title: "你是【男孩型】",
            subtitle: "關於自己，你還在學著怎麼相信。",
            desc: `
<span class="section-header">你的樣子</span>
你有很強的感受力，對世界充滿好奇，也對自己充滿問號。你常常會想：「我到底夠不夠好？」「我能不能被喜歡、被理解？」這種敏感，讓你更容易看見別人的情緒，也更容易忽略自己的需要。

<span class="section-header">你給別人的感覺</span>
在別人眼中，你像一個正在長大的孩子，真誠、直接、很真實。你會為了關係不斷自我檢討，只想讓自己變得更好。很多人因為你願意說出的脆弱，而覺得被陪伴。

<span class="section-header">給你的提醒</span>
你不需要完美才值得被愛。試著多看看自己已經做得不錯的地方，允許「還在路上」的自己存在。當你願意對自己溫柔一點，你就會發現：原來你早就已經是某個人心裡，很重要的那個存在。`
        },
        D: {
            title: "你是【鼴鼠型】",
            subtitle: "你的溫柔，是世界很需要的溫柔。",
            desc: `
<span class="section-header">你的樣子</span>
你很重視「舒服感」——食物、氣氛、陪伴、小確幸。你知道人不可能每天都很強，所以你特別會照顧情緒、照顧氣氛。你會為別人準備點心、傳訊息問候、講些好笑的話，讓沈重變得沒那麼可怕。

<span class="section-header">你給人的感覺</span>
你像一個會做甜點的好朋友，可能不會給一大串理性分析，但總會讓人覺得：「跟你在一起就不那麼難過了吧。」很多人其實靠你的存在，才撐過了一些很黑暗的日子。

<span class="section-header">給你的提醒</span>
在照顧別人之前，也別忘了一句：「那我自己呢？」你值得把同樣的溫柔，留一份給自己。偶爾不用那麼逗趣、那麼體貼，也沒關係——就算今天只想躺著，你一樣是很可愛的你。`
        }
    };

    /* =========================================
       2. 程式邏輯區
       =========================================
    */

    let currentQuestionIndex = 0;
    let scores = { A: 0, B: 0, C: 0, D: 0 };
    let selectedOption = null;
    let myRadarChart = null;

    // 移除原本的 DOMContentLoaded 自動開始，改為手動觸發
    // document.addEventListener("DOMContentLoaded", () => { ... });

    // --- 新增：開始測驗函數 ---
    function startQuiz() {
        // 隱藏封面
        document.getElementById("cover-section").style.display = "none";
        // 顯示題目區
        document.getElementById("quiz-section").style.display = "block";
        
        // 初始化
        currentQuestionIndex = 0;
        scores = { A: 0, B: 0, C: 0, D: 0 };
        selectedOption = null;
        renderQuestion();
        updateProgressBar();
    }

    // 渲染題目
    function renderQuestion() {
        const qData = questions[currentQuestionIndex];
        
        document.getElementById("question-number").innerText = `Question ${currentQuestionIndex + 1} / ${questions.length}`;
        document.getElementById("question-text").innerText = qData.text;
        
        const optionsContainer = document.getElementById("options-container");
        optionsContainer.innerHTML = ""; 

        qData.options.forEach((opt) => {
            const label = document.createElement("label");
            label.className = "option-label";
            label.onclick = () => selectOption(opt.type, label); 

            const radio = document.createElement("input");
            radio.type = "radio";
            radio.name = "quiz-option";
            radio.value = opt.type;

            const span = document.createElement("span");
            span.innerText = opt.text;

            label.appendChild(radio);
            label.appendChild(span);
            optionsContainer.appendChild(label);
        });

        document.getElementById("next-btn").disabled = true;
        document.getElementById("next-btn").innerText = (currentQuestionIndex === questions.length - 1) ? "查看結果" : "下一題";
        selectedOption = null;
    }

    // 選擇選項
    function selectOption(type, labelElement) {
        selectedOption = type;
        const allLabels = document.querySelectorAll(".option-label");
        allLabels.forEach(l => {
            l.classList.remove("selected");
            l.querySelector("input").checked = false;
        });
        labelElement.classList.add("selected");
        labelElement.querySelector("input").checked = true;
        document.getElementById("next-btn").disabled = false;
    }

    // 下一題
    function nextQuestion() {
        if (!selectedOption) return;
        scores[selectedOption]++;
        if (currentQuestionIndex < questions.length - 1) {
            currentQuestionIndex++;
            renderQuestion();
            updateProgressBar();
        } else {
            updateProgressBar(true);
            showResults();
        }
    }

    // 進度條
    function updateProgressBar(isFull = false) {
        const bar = document.getElementById("progressBar");
        if (isFull) {
            bar.style.width = "100%";
        } else {
            const percentage = ((currentQuestionIndex) / questions.length) * 100;
            bar.style.width = `${percentage}%`;
        }
    }

    // 顯示結果
    function showResults() {
        document.getElementById("quiz-section").style.display = "none";
        document.getElementById("result-section").style.display = "block";
        drawRadarChart();
        generateAnalysisText();
    }

    // 產生解析
    function generateAnalysisText() {
        let maxScore = 0;
        for (let key in scores) {
            if (scores[key] > maxScore) maxScore = scores[key];
        }

        let topTypes = [];
        for (let key in scores) {
            if (scores[key] === maxScore) topTypes.push(key);
        }

        let finalTitle = "";
        let finalDesc = "";

        if (topTypes.length === 1) {
            const type = topTypes[0];
            finalTitle = resultsData[type].title;
            finalDesc = `<h3 style='margin-bottom:20px; color:#555;'>${resultsData[type].subtitle}</h3>` + resultsData[type].desc;
        } else {
            finalTitle = "混合型靈魂";
            finalDesc = "<h3 style='margin-bottom:20px; color:#555;'>你擁有豐富多樣的特質</h3>";
            topTypes.forEach(type => {
                finalDesc += `<div style="margin-bottom:30px; border-top:1px dashed #ccc; padding-top:20px;">
                                <h2 style="margin-top:0;">${resultsData[type].title}</h2>
                                <h4 style="margin:5px 0 15px; color:#666;">${resultsData[type].subtitle}</h4>
                                ${resultsData[type].desc}
                              </div>`;
            });
        }

        document.getElementById("main-result-type").innerText = finalTitle;
        document.getElementById("full-analysis").innerHTML = finalDesc;
    }

    // 繪製雷達圖
    function drawRadarChart() {
        const ctx = document.getElementById('radarChart').getContext('2d');
        if (myRadarChart) myRadarChart.destroy();

        myRadarChart = new Chart(ctx, {
            type: 'radar',
            data: {
                labels: ['馬型 (行動)', '狐狸型 (思考)', '男孩型 (敏銳)', '鼴鼠型 (溫暖)'],
                datasets: [{
                    label: '特質比重',
                    data: [scores.A, scores.B, scores.C, scores.D],
                    backgroundColor: 'rgba(85, 85, 85, 0.2)',
                    borderColor: 'rgba(85, 85, 85, 1)',
                    borderWidth: 2,
                    pointBackgroundColor: 'rgba(0, 0, 0, 1)',
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    r: {
                        angleLines: { display: true },
                        suggestedMin: 0,
                        suggestedMax: 5,
                        ticks: { stepSize: 1 },
                        pointLabels: {
                            font: { size: 14, family: '"BiaoKai", "KaiTi", serif' },
                            color: '#000'
                        }
                    }
                },
                plugins: { legend: { display: false } }
            }
        });
    }

    function downloadChart() {
        const link = document.createElement('a');
        link.download = 'animal-soul-result.png';
        link.href = document.getElementById('radarChart').toDataURL('image/png');
        link.click();
    }

    // 重新測驗 (修改為回到第一題，而非封面)
    function restartQuiz() {
        currentQuestionIndex = 0;
        scores = { A: 0, B: 0, C: 0, D: 0 };
        selectedOption = null;
        document.getElementById("result-section").style.display = "none";
        document.getElementById("cover-section").style.display = "none"; // 確保封面隱藏
        document.getElementById("quiz-section").style.display = "block";
        renderQuestion();
        updateProgressBar();
    }
</script>

</body>
</html>
